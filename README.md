# ğŸ†ì¡¸ì—…ì‘í’ˆ ìš°ìˆ˜ í¬ìŠ¤í„°ìƒ - í† ë‹¥í† ë‹¥ í”„ë¡œì íŠ¸ (ëª¨ë°”ì¼)

<img src="https://img.shields.io/badge/platform-firebase-blue">  <img src="https://img.shields.io/badge/platform-android-green"> 

## Summary

![final](https://user-images.githubusercontent.com/63048392/115654781-cf9e8500-a36c-11eb-96b6-550dc4d99f2e.png)

ì´ ì•ˆë“œë¡œì´ë“œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ë¶ˆì•ˆ ì¥ì• ë¥¼ ë§‰ê³  ì§‘ë‹¨ ì§€ì„±ì„ í†µí•´ ì¹˜ìœ í•˜ê¸° ìœ„í•´ ê°œë°œëœ ì–´í”Œì…ë‹ˆë‹¤. 
ì•ˆë“œë¡œì´ë“œì™€ ì›¹ì˜ ìœ ê¸°ì ì¸ ì—°ê²°ì„ í†µí•´ì„œ ìì‹ ì˜ ë¶ˆì•ˆ ì •ë„ë¥¼ í™•ì¸í•˜ê³  í•´ê²° ë°©ì•ˆì— ëŒ€í•´ ì œì‹œí•  ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.
ì–¼êµ´ ê°ì • ì¸ì‹, ì±—ë´‡ ìƒë‹´ì„ í†µí•´ì„œ ìì‹ ì˜ ê°ì • ì •ë„ë¥¼ íŒŒì•…í•˜ê³  ì»¬ëŸ¬í…Œë¼í”¼, ì§‘ë‹¨ì§€ì„±ì„ í†µí•´ì„œ í˜ë“  ê°ì •ì„ ì¹˜ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 






## Requirements
- Android API level 15+
- Firebase Key
- Microsoft Azure API
- Adruino

## Description
- category menu

   4ê°€ì§€ ë¶„ë¥˜(ê°€ì¡±, ì„±, ëŒ€ì¸ê´€ê³„, ìê¸°ê°œë…)ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°ê°ì˜ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì»¤ë®¤ë‹ˆí‹° ê´€ì°° ê°€ëŠ¥
   
- writing solution

  ì›¹ ì±—ë´‡ì„ í†µí•´ ìƒë‹´ ì§„í–‰ í›„ì— ê°€ëŠ¥
  
  ì›¹ ì±—ë´‡ì„ í†µí•´ ìƒë‹´ì„ ì§„í–‰í•˜ê³  ë‚˜ë©´ ê·¸ ì •ë³´ë‹¤ databaseì— ë“¤ì–´ê°€ê²Œ ë˜ê³  report menu ì—ì„œ ê·¸ ì •ë³´ë¥¼ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤
  
  ì›í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ í•­ëª©ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ìƒë‹´ì— ëŒ€í•´ ìì‹ ì˜ ìƒê°ì„ ì‘ì„± ê°€ëŠ¥

- report detail

  ìì‹ ì´ solutionì„ ì‘ì„±í–ˆë‹¤ë©´ communityì— ì˜¬ë¼ê°„ ê²ƒì„ í™•ì¸ ê°€ëŠ¥
  
  ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ê°€ëŠ¥
  
  ìµœì‹ ìˆœ, ì¸ê¸°ìˆœ ë²„íŠ¼ì„ í†µí•´ì„œ ì¬ì •ë ¬ ê°€ëŠ¥
  
  í•´ë‹¹ community í•­ëª© í´ë¦­ ì‹œ ìì‹ ì˜ ìƒë‹´ ì •ë³´ ì—´ëŒ ê°€ëŠ¥

- Face Recognition

  microsoftì˜ azure api ì‚¬ìš©
  
  ìì‹ ì˜ ì–¼êµ´ ì‚¬ì§„ì„ ì°ê³  ê°ì •ì— ëŒ€í•´ì„œ ë¶„ì„
  
  ë¶„ì„ ê²°ê³¼ë¥¼ í†µí•´ ê°ì •ê³¼ í¼ì„¼íŠ¸ë¥¼ ë‚˜íƒ€ëƒ„

## Demo App


<img src="https://user-images.githubusercontent.com/63048392/114255991-121da480-99f2-11eb-84ca-5a4dae51d699.png" width="200" height="350"> <img src="https://user-images.githubusercontent.com/63048392/114255996-13e76800-99f2-11eb-9704-c531e1c0a39e.png" width="200" height="350"> <img src="https://user-images.githubusercontent.com/63048392/114256087-a7209d80-99f2-11eb-9079-54ad1547d308.png" width="200" height="350"> <img src="https://user-images.githubusercontent.com/63048392/114256080-a25be980-99f2-11eb-805f-dfad0be6b6ff.png" width="200" height="350"> 


ìì„¸í•œ í˜ì´ì§€ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ ë§í¬ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥

https://www.youtube.com/watch?v=prTo8yogprE&t=519s


## Firebase Query

- anxiety information: about_anxiety, cause1, cause2, result_color, result_explain, uid
- anxiety information for report: about_anxiety, cause1, cause2, result_color, result_explain, uid
- community: Cause1, date, recommendCount, uid, writing
- face recognition: myuid, percent, sentiment
- recommend: (destinationuid: true)

## Migration Guide

### Community Fragment
- ì•„ë˜ëŠ” ê¸°ë³¸ì ì¸ ì»¤ë®¤ë‹ˆí‹° ì½”ë“œì…ë‹ˆë‹¤

```c
 context = rootview.getContext();
        recyclerView = rootview.findViewById(R.id.recylerview); //ì•„ë”” ì—°ê²°
        recyclerView.setHasFixedSize(true); //ë¦¬ì‚¬ì´í´ëŸ¬ë·° ê¸°ì¡´ì„±ëŠ¥ ê°•í™”
        layoutManger = new LinearLayoutManager(context);
        recyclerView.setLayoutManager(layoutManger);
        arrayList = new ArrayList<>(); //User ê°ì²´ë¥¼ ë‹´ì„ ì–´ë ˆì´ ë¦¬ìŠ¤íŠ¸ (ì–´ëŒ‘í„° ìª½ìœ¼ë¡œ)
        database = FirebaseDatabase.getInstance(); //íŒŒì´ì–´ë² ì´ìŠ¤ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™

        databaseReference = database.getReference("community"); //íŒŒì´ì–´ ë² ì´ìŠ¤ì—ì„œ user
        databaseReference.addValueEventListener(new ValueEventListener() {
            @Override
            public void onDataChange(@NonNull DataSnapshot dataSnapshot) {
                // íŒŒì´ì–´ë² ì´ìŠ¤ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ê³³
                arrayList.clear(); //ê¸°ì¡´ ë°°ì—´ë¦¬ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šê²Œ ì´ˆê¸°í™”
                for (DataSnapshot snapshot : dataSnapshot.getChildren()) { //ë°˜ë³µë¬¸ìœ¼ë¡œ ë°ì´í„° listë¥¼ ì¶”ì¶œí•´ëƒ„
                    community_user user1 = snapshot.getValue(community_user.class); //ë§Œë“¤ì–´ë’€ë˜ User ê°ì²´ì— ë°ì´í„°ë¥¼ ë‹´ëŠ”
                    arrayList.add(user1); // ë‹´ì€ ë°ì´í„°ë“¤ì„ ë°°ì—´ë¦¬ìŠ¤íŠ¸ì— ë„£ê³  ë¦¬ì‚¬ì´í´ëŸ¬ë·°ë¡œ ë³´ë‚¼ ì¤€ë¹„
                }
                adapter.notifyDataSetChanged(); //ë¦¬ìŠ¤íŠ¸ ì €ì¥ ë° ìƒˆë¡œê³ ì¹¨
            }

            @Override
            public void onCancelled(@NonNull DatabaseError databaseError) {
            }
        });

```

- ì•„ë˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë™ì‘í•˜ê²Œ í•˜ëŠ” adapterì˜ ì½”ë“œë¡œ í•„ìˆ˜ì ìœ¼ë¡œ ì‘ì„±ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

```c
  adapter = new CustomAdapter(arrayList, context, new CustomAdapter.OnItemClickListener() {
            @Override
            public void onItemClick(View view, int position) {
                final Intent intent = new Intent(view.getContext(), community_detail.class);
                final String destinationUid = arrayList.get(position).uid;
                final String date1 = arrayList.get(position).date;

                final Bundle InfoBundle = new Bundle();
                DestinationUid = destinationUid;
                databaseReference.addValueEventListener(new ValueEventListener() {
                    @Override
                    public void onDataChange(@NonNull DataSnapshot dataSnapshot) {
                        for (DataSnapshot snapshot : dataSnapshot.getChildren()) { //ë°˜ë³µë¬¸ìœ¼ë¡œ ë°ì´í„° listë¥¼ ì¶”ì¶œí•´ëƒ„
                            String uid = snapshot.child("uid").getValue(String.class); //uid
                            String date2 = snapshot.child("date").getValue(String.class); //uid

                            if (uid.equals(destinationUid)&& date1.equals(date2)) {
                                InfoBundle.putString("destinationUid", destinationUid);
                                InfoBundle.putString("date", date2);
                                InfoBundle.putString("writing", snapshot.child("writing").getValue(String.class));
                                intent.putExtras(InfoBundle);

                                startActivity(intent);
                                break;
                            } else {
                                continue;
                            }
                        }
                    }
                    @Override
                    public void onCancelled(@NonNull DatabaseError databaseError) {
                    }
                });


            }
        });
        recyclerView.setAdapter(adapter); //ë¦¬ì‚¬ì´í´ëŸ¬ë·°ì— ì–´ëŒ‘í„° ì—°ê²°
```



### FaceRecognition Fragment
- ìì‹ ì˜ ì–¼êµ´ ê°ì •ì„ ì¸ì‹í•˜ê¸° ìœ„í•´ì„œ ì¹´ë©”ë¼ ì ‘ê·¼ì„ ë¨¼ì € í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- ì•„ë˜ëŠ” ì¹´ë©”ë¼ ì ‘ê·¼ í—ˆìš© ì½”ë“œì…ë‹ˆë‹¤.

```c
  if (ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {
                    ActivityCompat.requestPermissions(FaceRecognitionAcitivity.this, new String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE}, 0);
                } else {

                    if (checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
                            == PackageManager.PERMISSION_GRANTED) { // contents }
                    else { // contents }
```

- ì•„ë˜ëŠ” Azureë¡œ ì–¼êµ´ ì´ë¯¸ì§€ë¥¼ ë³´ë‚´ê³  ê·¸ ì´ë¯¸ì§€ì— ëŒ€í•´ì„œ ê°ì • ë¶„ì„ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
- Azure API Keyê°€ í•„ìˆ˜ë¡œ ì…ë ¥ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. 

```c
  @Override
            protected void onPostExecute(Face[] faces) {
                pd.dismiss();
                Intent intent = new Intent(getApplicationContext(), ResultActivity.class);
                Gson gson = new Gson();
                String data = gson.toJson(faces);
                if (faces == null || faces.length == 0) {
                    makeToast("No faces detected. You may not have added the API Key or try retaking the picture.");
                } else {
                    intent.putExtra("list_faces", data);
                    ByteArrayOutputStream stream = new ByteArrayOutputStream();
                    mBitmap.compress(Bitmap.CompressFormat.PNG, 100, stream);
                    byte[] byteArray = stream.toByteArray();

                    intent.putExtra("image", byteArray);
                    startActivity(intent);
                }

            }
        };
        detectTask.execute(inputStream);
    }
```



### IotFragment
- ì•„ë˜ ì½”ë“œì— ìì‹ ì˜ uuidì™€ blue toothì˜ MACì£¼ì†Œë¥¼ ê¸°ì…í•©ë‹ˆë‹¤
```c
  private static final UUID MY_UUID = UUID.fromString(""); // SPP UUID service
  private static String address = ""; // MAC-address of Bluetooth module (you must edit this line)
```

- ì•„ë‘ì´ë…¸ bluetooth ëª¨ë“ˆì„ ì¼œì„œ ì•„ë˜ ì½”ë“œì—ì„œ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤
```c
 private void checkBTState() {
        // Check for Bluetooth support and then check to make sure it is turned on
        // Emulator doesn't support Bluetooth and will return null
        if(btAdapter==null) {
            errorExit("Fatal Error", "Bluetooth not support");
        } else {
            if (btAdapter.isEnabled()) {
                Log.d(TAG, "...Bluetooth ON...");
            } else {
                //Prompt user to turn on Bluetooth
                Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
                startActivityForResult(enableBtIntent, 1);
            }
        }
    }
```
- ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ì„œ ë¸”ë£¨íˆ¬ìŠ¤ì™€ í†µì‹ ì„ í•˜ì—¬ ìƒ‰ì„ ë°”ê¿”ì¤ë‹ˆë‹¤.
- ë²„íŠ¼ í´ë¦­ì‹œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ì„œ ëŒ€ìƒì˜ ìƒ‰ì„ ì§€ì •í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

```c
       h = new Handler() {
            public void handleMessage(android.os.Message msg) {
                switch (msg.what) {
                    case RECIEVE_MESSAGE:
                        byte[] readBuf = (byte[]) msg.obj;
                        String strIncom = new String(readBuf, 0, msg.arg1);
                        sb.append(strIncom);
                        int endOfLineIndex = sb.indexOf("\r\n");
                        if (endOfLineIndex > 0) {
                            String sbprint = sb.substring(0, endOfLineIndex);
                            sb.delete(0, sb.length());
                            txtArduino.setText("Data from Arduino: " + sbprint);
                            if(flag%4==3){
                                rlayout.setBackgroundColor(Color.rgb(255, 255, 255));
                            }
                            else if(flag%4==1){ //R
                                rlayout.setBackgroundColor(Color.rgb(255, 0, 0));
                            }
```


